#!/bin/bash
# MySQL 备份配置文件
# 路径: /etc/mysql-backup/backup.conf

# 数据库连接配置
MYSQL_HOST="localhost"
MYSQL_PORT="3306"
MYSQL_USER="backup_user"
MYSQL_PASSWORD="your_password"

# 要备份的数据库(多个数据库用空格分隔,使用 "all" 备份所有数据库)
DATABASES="database1 database2"
# DATABASES="all"

# 备份模式
# "separate" - 每个数据库单独备份为一个文件 (推荐)
# "single" - 所有数据库备份到一个文件
BACKUP_MODE="separate"

# 备份目录
BACKUP_DIR="/var/backups/mysql"

# 备份文件命名格式
# 可用变量: {dbname}, {date}, {time}, {timestamp}
# separate 模式: {dbname}_{timestamp}.sql
# single 模式: all_databases_{timestamp}.sql
BACKUP_FILENAME_FORMAT="{dbname}_{timestamp}"

# 备份文件保留设置
KEEP_DAYS=7          # 保留最近N天的备份
KEEP_COUNT=10        # 保留最近N个备份文件 (0表示不限制)

# 每个数据库单独设置保留策略 (可选)
# 格式: "数据库名:保留天数:保留数量"
# 示例: DATABASE_RETENTION["important_db"]="30:20"  # 保留30天或最近20个
declare -A DATABASE_RETENTION
# DATABASE_RETENTION["important_db"]="30:20"
# DATABASE_RETENTION["test_db"]="3:5"

# 压缩设置
COMPRESSION="gzip"   # 压缩方式: gzip, bzip2, xz, none
COMPRESSION_LEVEL=6  # 压缩级别 (1-9)

# 备份后操作 (可选)
RESTART_MYSQL=false         # 备份后是否重启MySQL
FLUSH_LOGS=true             # 备份后是否刷新日志
PURGE_BINARY_LOGS=true      # 是否清理二进制日志
BINARY_LOGS_KEEP_DAYS=3     # 保留二进制日志天数

# 并行备份设置
PARALLEL_BACKUPS=1          # 并行备份的数据库数量 (1=顺序执行)

# 备份通知 (可选)
ENABLE_EMAIL_NOTIFY=false
EMAIL_TO="admin@example.com"
EMAIL_SUBJECT="MySQL Backup Report"

# 日志设置
LOG_FILE="/var/log/mysql-backup/backup.log"
LOG_LEVEL="INFO"  # DEBUG, INFO, WARN, ERROR

# mysqldump 额外参数
MYSQLDUMP_OPTS="--single-transaction --quick --lock-tables=false --routines --triggers --events"

# 排除的数据库 (不备份)
EXCLUDE_DATABASES="information_schema performance_schema mysql sys"